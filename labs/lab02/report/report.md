---
## Front matter
title: "Отчёт по лабораторной работе №2"
subtitle: "Управление пользователями и группами"
author: "Тукаев Тимур"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить представление о работе с учётными записями пользователей и группами пользователей в операционной системе типа Linux.

# Выполнение

## Переключение учётных записей пользователей

1. В системе выполнен вход под обычным пользователем и открыт терминал.  
   Для определения активной учётной записи использована команда `whoami`, которая показала, что текущий пользователь — `titukaev`.  

   Затем выполнена команда `id`. Отображены следующие данные:
   - `uid=1000(titukaev)` — уникальный идентификатор пользователя;
   - `gid=1000(titukaev)` — идентификатор основной группы пользователя;
   - `groups=1000(titukaev),10(wheel)` — пользователь состоит в собственной группе и в группе `wheel`, что даёт возможность получать административные права;
   - также показан SELinux-контекст текущего процесса.  

   ![Определение пользователя и его групп](Screenshot_1.png){ #fig:001 width=80% }

2. Для переключения к учётной записи суперпользователя использована команда `su`.  
   После ввода пароля root выполнен переход в контекст суперпользователя, что подтверждено приглашением командной строки.

   Команда `id`, выполненная под root, показала:
   - `uid=0(root)` — идентификатор суперпользователя;
   - `gid=0(root)` — основная группа root;
   - группы, к которым относится root;
   - SELinux-контекст для пользователя root.  

   Возврат к обычному пользователю выполнен с помощью команды `exit`.

## Просмотр и анализ файла /etc/sudoers

3. Для безопасного редактирования конфигурации прав `sudo` использована команда `sudo -i visudo`.  
   В результате был открыт файл `/etc/sudoers` в редакторе, настроенном по умолчанию (vim).

   ![Файл sudoers, открытый через visudo](Screenshot_2.png){ #fig:002 width=80% }

   **Почему требуется использовать visudo, а не произвольный редактор?**  
   Файл `/etc/sudoers` критически важен для работы механизма `sudo`. Если при редактировании допустить синтаксическую ошибку, система может полностью потерять возможность выдавать административные права через `sudo`.  
   Утилита `visudo`:
   - блокирует файл от одновременного редактирования несколькими пользователями;
   - проверяет синтаксис файла перед сохранением;
   - в случае ошибки не перезаписывает рабочую конфигурацию.  

   Поэтому для работы с `/etc/sudoers` необходимо пользоваться именно `visudo`.

4. В файле `/etc/sudoers` найдена строка:

   `%wheel ALL=(ALL) ALL`

   Эта запись означает, что **все пользователи, входящие в группу `wheel`**, имеют право выполнять через `sudo` **любые команды** от имени **любого пользователя** (в том числе root) на любой машине, где действует данная конфигурация.  
   Группа `wheel` используется как механизм ограниченного делегирования административных привилегий: достаточно добавить пользователя в эту группу, чтобы он получил возможность выполнять команды от имени суперпользователя через `sudo`.

## Создание пользователей alice и bob

5. Пользователь `alice` был создан с включением в группу `wheel` командой  
   `sudo -i useradd -G wheel alice`.  

   Далее выполнена команда `id alice`, подтвердившая:
   - наличие пользователя `alice` с собственным `uid`;
   - принадлежность к основной группе `alice`;
   - принадлежность к дополнительной группе `wheel`.  

6. Для пользователя `alice` установлен пароль с помощью `sudo -i passwd alice`.  
   Пароль вводился дважды, после чего система сообщила об успешном обновлении.

7. Затем выполнено переключение на учётную запись `alice` командой `su alice`.  

8. Находясь под пользователем `alice`, создан пользователь `bob` командой  
   `sudo useradd bob`.  
   При этом система запросила пароль от `alice` для выполнения команды с повышенными привилегиями.

9. Для пользователя `bob` установлен пароль командой `sudo passwd bob`.  
   После ввода и подтверждения пароля система сообщила об успешной смене пароля.

10. Командой `id bob` проверены параметры новой учётной записи:

    ![Создание пользователей alice и bob](Screenshot_3.png){ #fig:003 width=80% }

    Из вывода видно:
    - `uid=1002(bob)` — идентификатор пользователя bob;
    - `gid=1002(bob)` — основная группа с тем же именем;
    - `groups=1002(bob)` — вторичных групп пока нет.

## Настройка общих параметров создания пользователей

11. Выполнено переключение в контекст root командой `su`.  

12. Открыт для редактирования файл конфигурации `/etc/login.defs` (редактор vim).  

    ![Редактирование файла /etc/login.defs](Screenshot_4.png){ #fig:004 width=80% }

    В файле проверены и изменены следующие параметры:

    - `CREATE_HOME yes` — при создании нового пользователя (`useradd`) автоматически создаётся его домашний каталог.  
    - `USERGROUPS_ENAB no` — новые пользователи не получают отдельную одноимённую группу; вместо этого используется общая группа `users`. Это влияет на то, какая группа будет назначена пользователю по умолчанию.

13. Выполнен переход в каталог `/etc/skel`.  
    В этом каталоге находятся файлы и папки, которые автоматически копируются в домашний каталог каждого нового пользователя.

    Созданы каталоги `Pictures` и `Documents` командами `mkdir Pictures` и `mkdir Documents`.  
    Теперь при создании новой учётной записи эти каталоги будут появляться в домашнем каталоге пользователя по умолчанию.

14. В файле `/etc/skel/.bashrc` добавлена строка:

    `export EDITOR=/usr/bin/vim`

    ![Настройка EDITOR и .bashrc](Screenshot_5.png){ #fig:005 width=80% }

    Это означает, что переменная окружения `EDITOR` будет автоматически задаваться для всех новых пользователей. Многие консольные утилиты (например, `crontab`, `visudo` при определённых настройках и др.) используют переменную `EDITOR`, чтобы узнать, какой текстовый редактор запускать для редактирования файлов.  
    В данном случае по умолчанию будет использоваться редактор `vim`.

## Создание и анализ учётной записи carol

15. В терминале выполнено переключение на учётную запись `alice` командой `su alice`.  

16. Находясь под пользователем `alice`, с использованием прав `sudo` создан пользователь `carol`:

    `sudo -i useradd carol`

17. Для пользователя `carol` задан пароль командой `sudo passwd carol`.  

18. Далее выполнено переключение на `carol` (команда `su carol`) и просмотр информации о нём:  

    - команда `id` показала:
      - `uid=1003(carol)` — идентификатор пользователя;
      - `gid=100(users)` — основной группой назначена `users` (как и задавалось параметром `USERGROUPS_ENAB no`);
      - перечислены вторичные группы (на данном этапе только `users`).  
    - переход в домашний каталог (`cd`) и просмотр его содержимого (`ls -Al`) показали наличие файлов и каталогов:
      - стандартные файлы инициализации: `.bash_logout`, `.bash_profile`, `.bashrc`;
      - каталоги `Documents` и `Pictures`, скопированные из `/etc/skel`.  

    ![Домашний каталог и информация о carol](Screenshot_6.png){ #fig:006 width=80% }

## Работа с файлом /etc/shadow и параметрами паролей

19. Находясь под пользователем `alice`, выполнен просмотр строки пароля пользователя `carol` в файле `/etc/shadow`:

    Использована команда вида `sudo cat /etc/shadow | grep carol`.  

    ![Просмотр и изменение записи carol в /etc/shadow](Screenshot_7.png){ #fig:007 width=80% }

    Строка имеет вид (обобщённо):

    `carol:хэш_пароля:20431:0:99999:7:::`

    Поля строки означают:
    - имя учётной записи (`carol`);
    - зашифрованный пароль (хэш);
    - число дней от 1 января 1970 года до даты последней смены пароля;
    - минимальное число дней до разрешения смены пароля;
    - максимальное число дней действия пароля;
    - количество дней предупреждения пользователя до истечения срока действия пароля;
    - число дней после истечения срока действия до блокировки;
    - дата окончательного отключения учётной записи (если задана).

20. Изменены свойства пароля пользователя `carol` командой вида  
    `sudo passwd -n 30 -w 3 -x 90 carol`.

    Параметры означают:
    - `-n 30` — минимальный срок использования пароля 30 дней (до истечения этого срока сменить пароль нельзя);
    - `-w 3` — за 3 дня до истечения срока действия пароля пользователь начнёт получать предупреждения;
    - `-x 90` — максимальный срок действия пароля 90 дней (после этого потребуется смена пароля).

21. Повторный вывод строки пользователя `carol` из `/etc/shadow` показал изменение соответствующих полей (минимальный срок, максимальный срок, период предупреждения).  

22. Проверено наличие идентификатора `alice` во всех трёх файлах:

    `grep alice /etc/passwd /etc/shadow /etc/group`

    Пользователь `alice` присутствует:
    - в `/etc/passwd` — общая информация (uid, gid, shell, домашний каталог);
    - в `/etc/shadow` — данные о пароле;
    - в `/etc/group` — членство в группах.

23. Для `carol` выполнена команда `sudo grep carol /etc/passwd /etc/shadow /etc/group`.  
    Пользователь присутствует в `/etc/passwd` и `/etc/shadow`, а в `/etc/group` отображается только в качестве члена групп, где он явно добавлен (по умолчанию — группа `users`). Это демонстрирует разделение информации о пользователе и его пароле (passwd/shadow) и о группах (group).

## Работа с группами

24. Находясь под учётной записью `alice`, были созданы две новые группы:

    - `main`
    - `third`

    Для этого использованы команды `sudo groupadd main` и `sudo groupadd third`.

25. После этого пользователи были добавлены в группы с помощью `usermod`:

    - `alice` добавлена в группу `main` (`sudo usermod -aG main alice`);
    - `bob` добавлен в группу `main` (`sudo usermod -aG main bob`);
    - `carol` добавлена в группу `third` (`sudo usermod -aG third carol`).

26. Командой `id carol` проверено, что пользователь `carol` корректно добавлен в группу `third`:

    - основная группа: `gid=100(users)`;
    - вторичная группа: `third` (с собственным `gid`).  
      Таким образом, `users` остаётся основной группой, а `third` — вторичной.

27. Аналогично выполнены команды `id alice` и `id bob` для анализа их членства в группах:

    ![Создание групп и проверка их состава](Screenshot_8.png){ #fig:008 width=80% }

    В результате получено:
    - **alice**:
      - основная группа — `alice`;
      - вторичные группы — `wheel`, `main` (и, возможно, другие стандартные группы).
    - **bob**:
      - основная группа — `bob`;
      - вторичная группа — `main`.
    - **carol**:
      - основная группа — `users`;
      - вторичная группа — `third`.

# Контрольные вопросы

1. Информацию о UID пользователя и его принадлежности к группам можно получить с помощью команд  
   `id`, `whoami`, а также просмотром файлов `/etc/passwd` и `/etc/group`.

2. Пользователь root имеет UID 0.  
   Узнать UID любого пользователя можно командой `id имя_пользователя` или просмотром файла `/etc/passwd`, где UID хранится в третьем поле каждой записи.

3. Команда `su` переключает контекст на другой аккаунт, полностью изменяя пользователя, тогда как `sudo` позволяет выполнять отдельные команды от имени суперпользователя, не покидая текущую учётную запись.  
   `su` требует пароль целевой учётной записи, `sudo` — пароль текущего пользователя, имеющего соответствующие права.

4. Параметры работы `sudo` определяются в конфигурационном файле `/etc/sudoers`, а также в дополнительных файлах каталога `/etc/sudoers.d`.

5. Для безопасного изменения конфигурации `sudo` используется команда `visudo`, поскольку она проверяет файл на синтаксические ошибки перед сохранением.

6. Чтобы предоставить пользователю доступ ко всем командам администрирования через sudo, его необходимо включить в группу `wheel` (или `sudo` — в зависимости от дистрибутива).

7. Для задания параметров, используемых при создании новых учётных записей, применяются:  
   — файл конфигурации `/etc/login.defs` (например, параметры `CREATE_HOME`, `USERGROUPS_ENAB`);  
   — каталог `/etc/skel`, содержащий файлы и настройки, копируемые в домашний каталог нового пользователя (`.bashrc`, каталоги Documents и Pictures).

8. Информация о первичной и дополнительных группах пользователей хранится в файлах `/etc/passwd` и `/etc/group`.  
   У пользователя alice запись в `/etc/passwd` содержит указание основной группы, а в `/etc/group` отображаются группы, в которых alice состоит как член.

9. Для изменения параметров пароля пользователя применяются команды `passwd` (например: минимальный, максимальный срок действия, предупреждения) и `chage`, позволяющие управлять сроками действия пароля более детально.

10. Для прямого изменения информации в файле `/etc/group` следует использовать команду `vigr`.  
    Она блокирует файл от одновременного редактирования и проверяет корректность структуры, что предотвращает повреждение системной конфигурации.

# Заключение

В ходе лабораторной работы были изучены механизмы управления учётными записями и группами в операционной системе Linux.  
Были рассмотрены способы переключения между пользователями, принципы работы команд `su` и `sudo`, а также правила безопасного редактирования файла конфигурации `/etc/sudoers`.  

На практике были созданы новые пользователи и группы, настроены параметры паролей и изучена структура системных файлов `/etc/passwd`, `/etc/shadow` и `/etc/group`.  
Особое внимание уделялось настройкам, влияющим на автоматическое создание домашнего каталога и применение шаблонов из `/etc/skel`.  

