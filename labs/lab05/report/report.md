---
## Front matter
title: "Отчёт по лабораторной работе №5"
subtitle: "Управление системными службами"
author: "Тукаев Тимур"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки управления системными службами операционной системы посредством systemd.

# Выполнение

## Управление сервисами

1. Получены полномочия администратора с помощью команды `su -`.

2. Выполнена проверка статуса службы Very Secure FTP (`vsftpd`). Поскольку пакет не был установлен, вывод показал отсутствие юнита в системе.

   ![Проверка статуса vsftpd](Screenshot_1.png){ #fig:001 width=80% }

3. Установлен пакет Very Secure FTP с помощью менеджера пакетов DNF. После обработки зависимостей компонент `vsftpd` был успешно установлен.

4. Выполнен запуск службы Very Secure FTP. Сервис был успешно активирован.

5. Повторная проверка статуса показала, что служба находится в состоянии `active (running)`, однако не включена в автозагрузку.

   ![Статус после запуска](Screenshot_2.png){ #fig:003 width=80% }

6. Служба добавлена в автозапуск с помощью `systemctl enable`. Повторная проверка подтвердила изменение состояния на `enabled`. Затем служба удалена из автозагрузки, и статус вернулся к `disabled`.

   ![Enable/Disable vsftpd](Screenshot_3.png){ #fig:004 width=80% }

7. Выведен список символических ссылок, которые соответствуют юнитам, запускаемым в таргете `multi-user.target`. Было подтверждено отсутствие ссылки на `vsftpd.service`.

8. Служба повторно добавлена в автозагрузку. Вывод списка ссылок показал появление символьной ссылки на файл юнита `vsftpd.service`.

   ![Создание ссылки vsftpd](Screenshot_4.png){ #fig:005 width=80% }

9. Статус службы проверен повторно. Теперь юнит имеет состояние `enabled`, а служба активна.

10. Выведен список зависимостей юнита `vsftpd`. Команда отобразила дерево зависимых служб и таргетов.

11. Выведен список юнитов, которые зависят от `vsftpd`, с использованием опции `--reverse`.

   ![Зависимости vsftpd](Screenshot_5.png){ #fig:007 width=80% }

## Конфликты юнитов (iptables и firewalld)

1. Получены полномочия администратора и установлен пакет iptables.

2. Проверен статус служб firewalld и iptables. Первая служба оказалась активной, вторая — неактивной.

   ![Статусы firewalld и iptables](Screenshot_6.png){ #fig:008 width=80% }

3. Выполнены попытки запуска обеих служб. Запуск одной служил причиной остановки другой, что указывает на конфликт.

4. Просмотрено содержимое юнит-файла `firewalld.service`. В параметрах обнаружена директива `Conflicts=iptables.service`, фиксирующая несовместимость этих сервисов.

   ![Юнит firewalld](Screenshot_7.png){ #fig:009 width=80% }

5. Просмотрено содержимое юнит-файла `iptables.service`, что позволило изучить особенности его запуска и конфигурации.

   ![Юнит iptables](Screenshot_8.png){ #fig:010 width=80% }

6. Служба iptables была остановлена, после чего без конфликтов запущена служба firewalld.

7. Для предотвращения случайного запуска iptables сервис был замаскирован. В каталоге `/etc/systemd/system/` появилась символическая ссылка на `/dev/null`.

   ![Маскирование iptables](Screenshot_9.png){ #fig:011 width=80% }

8. Попытка запуска iptables привела к сообщению об ошибке, что юнит замаскирован и не может быть активирован.

9. Аналогично завершилась попытка добавить iptables в автозапуск: система сообщила, что юнит замаскирован и не может быть включён.

## Изолируемые цели

1. Получены полномочия администратора, выполнен переход в каталог `/usr/lib/systemd/system`, после чего выполнен поиск всех целей, поддерживающих изоляцию. В вывод попали только те `.target`-файлы, в которых присутствует строка `AllowIsolate=yes`.

   ![Поиск изолируемых целей](Screenshot_10.png){ #fig:012 width=80% }

2. Операционная система была переключена в режим восстановления с помощью изоляции цели `rescue.target`. На консоли появилось сообщение о входе в режим rescue и запрос пароля суперпользователя, после чего был предоставлен доступ к окружению восстановления.

   ![Переход в rescue.target](Screenshot_11.png){ #fig:013 width=80% }

3. Выполнен перезапуск операционной системы через изоляцию цели `reboot.target`. После выполнения команды система инициировала процесс перезагрузки.

## Цель по умолчанию

1. Получены привилегии администратора. Выведена текущая цель, установленная по умолчанию. В данном случае система загружалась в режиме `graphical.target`.

   ![Проверка default target](Screenshot_12.png){ #fig:014 width=80% }

2. По умолчанию был установлен текстовый режим загрузки путём выбора цели `multi-user.target`. После выполнения команды была перезаписана ссылка `default.target`, направленная на выбранный таргет.

   После перезагрузки система действительно загрузилась в текстовом режиме.

3. Выполнено переключение обратно в графический режим. Цель по умолчанию изменена на `graphical.target`, что также привело к обновлению символической ссылки `default.target`.  

   После очередной перезагрузки система запустилась в графическом режиме.

   ![Установка графической цели и перезагрузка](Screenshot_13.png){ #fig:015 width=80% }

# Контрольные вопросы

1. Юнит (unit) — это объект systemd, описывающий ресурс или действие в системе.  
   Примеры: `service` (сервис), `target` (цель), `mount` (точка монтирования), `timer` (таймер), `socket` (сокет).

2. Чтобы убедиться, что цель больше не включена в автозапуск, используют команду `systemctl disable`, а затем проверяют её состояние командой `systemctl status`.

3. Для отображения всех загруженных сервисных юнитов применяется команда  
   `systemctl --type=service`.

4. Чтобы создать потребность (wants) в сервисе, используют команду  
   `systemctl enable`, которая создаёт символическую ссылку в каталоге `*.wants/`.

5. Для переключения системы в режим восстановления выполняют команду  
   `systemctl isolate rescue.target`.

6. Сообщение о невозможности изоляции цели появляется, если в её юнит-файле отсутствует параметр `AllowIsolate=yes`, что делает её недоступной для изоляции.

7. Чтобы определить, какие юниты зависят от конкретной службы, используют команду  
   `systemctl list-dependencies <unit> --reverse`.

# Заключение

В ходе лабораторной работы были изучены механизмы управления системными службами и целями в среде systemd. На практических примерах выполнены установка, запуск, остановка и настройка автозагрузки сервисов, а также разбор конфликтов между ними. Особое внимание уделено работе с изолируемыми целями, которые позволяют переключать систему в различные режимы, такие как восстановление или перезагрузка. Были рассмотрены зависимости юнитов, порядок их загрузки и способы предотвращения запуска конфликтующих служб посредством маскирования.  
