---
## Front matter
title: "Отчёт по лабораторной работе №7"
subtitle: "Управление журналами событий в системе"
author: "Тукаев Тимур"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с журналами мониторинга различных событий в системе.

# Выполнение

## Мониторинг журнала системных событий в реальном времени

1. Запущено три окна терминала.  
   В каждом окне получены права администратора с использованием команды `su -`.  

2. Во втором окне терминала запущен мониторинг системных событий в реальном времени.  
   Команда позволяет отслеживать поступающие сообщения ядра и системных служб.  

3. В третьем окне выполнен выход из режима суперпользователя с помощью `Ctrl + D`.  
   Затем произведена попытка повторного входа с неверным паролем.  
   В результате во втором окне отобразилось сообщение об ошибке аутентификации `FAILED SU (to root) titukaev on pts/1`, которое также зафиксировано в журнале `/var/log/messages`.  

   ![Ошибка при вводе пароля root](Screenshot_1.png){ #fig:001 width=80% }

4. В третьем окне введена команда `logger hello`.  
   Во втором окне с активным мониторингом отобразилось сообщение, подтверждающее регистрацию записи в журнале `/var/log/messages`.  

   ![Регистрация пользовательского сообщения в журнале](Screenshot_2.png){ #fig:002 width=80% }

5. Мониторинг системных сообщений остановлен сочетанием клавиш `Ctrl + C`.  
   Затем выполнен просмотр последних 20 строк журнала безопасности.  
   В выводе зафиксированы события успешных и неуспешных попыток получения прав суперпользователя, а также операции открытия и закрытия сессий.  

   ![Анализ лога безопасности /var/log/secure](Screenshot_3.png){ #fig:003 width=80% }

## Изменение правил rsyslog.conf

1. Установлен веб-сервер Apache.  
   После завершения установки служба была запущена и добавлена в автозагрузку.  

   ![Установка и запуск службы Apache](Screenshot_4.png){ #fig:004 width=80% }

2. Выполнен просмотр журнала ошибок веб-службы для проверки её работы.  
   В логе отображены уведомления о запуске и настройке Apache, а также о корректном применении контекста SELinux.  

   ![Проверка журнала ошибок Apache](Screenshot_5.png){ #fig:005 width=80% }

3. В конфигурационном файле `/etc/httpd/conf/httpd.conf` добавлена строка  
   `ErrorLog syslog:local1`,  
   обеспечивающая передачу сообщений об ошибках веб-службы через систему журналирования rsyslog.  

   ![Редактирование конфигурационного файла httpd.conf](Screenshot_6.png){ #fig:006 width=80% }

4. В каталоге `/etc/rsyslog.d` создан файл `httpd.conf`,  
   в котором прописано правило `local1.* -/var/log/httpd-error.log`,  
   направляющее сообщения категории `local1` в отдельный файл журнала `/var/log/httpd-error.log`.  

   ![Создание правила для регистрации сообщений Apache в rsyslog](Screenshot_7.png){ #fig:007 width=80% }

5. Создан отдельный файл конфигурации `debug.conf` для регистрации отладочных сообщений.  
   В него добавлено правило `*.debug /var/log/messages-debug`,  
   позволяющее сохранять сообщения уровня отладки в отдельный лог-файл.  

   ![Создание файла конфигурации для отладочных сообщений](Screenshot_8.png){ #fig:008 width=80% }

6. После внесённых изменений службы `rsyslog` и `httpd` были перезапущены.  
   При генерации отладочного сообщения с помощью `logger -p daemon.debug "Daemon Debug Message"`  
   запись появилась в файле `/var/log/messages-debug`, что подтвердило корректность настроек.  

   ![Регистрация отладочного сообщения в системном журнале](Screenshot_9.png){ #fig:009 width=80% }

## Использование journalctl

1. Просмотрен системный журнал с момента последнего запуска системы.  
   Отображены сообщения ядра, включая сведения о версии Linux, параметрах BIOS и аппаратной конфигурации.  

   ![Просмотр системного журнала после запуска системы](Screenshot_10.png){ #fig:010 width=80% }

2. Произведён просмотр журнала без использования пейджера для вывода всех сообщений в непрерывном виде.  
   Это позволяет анализировать логи без постраничной навигации.  

   ![Просмотр журнала без пейджера](Screenshot_11.png){ #fig:011 width=80% }

3. Активирован режим мониторинга журнала в реальном времени.  
   В ходе наблюдения зафиксированы ошибки, связанные с процессом `VBoxClient`, приведшие к созданию дампа ядра.  

   ![Мониторинг журнала в реальном времени и фиксация ошибок VBoxClient](Screenshot_12.png){ #fig:012 width=80% }

4. Выполнен просмотр всех доступных параметров фильтрации с помощью двойного нажатия клавиши Tab после ввода команды `journalctl`.  
   В списке представлены ключи, позволяющие выполнять выборку по полям системных сообщений.  

   ![Просмотр параметров фильтрации журнала](Screenshot_13.png){ #fig:013 width=80% }

5. Выполнен фильтр вывода по идентификатору пользователя с UID 0, чтобы отобразить все события, связанные с пользователем root.  

   ![Фильтрация сообщений журнала по UID 0](Screenshot_14.png){ #fig:014 width=80% }

6. Произведён просмотр последних 20 строк системного журнала для анализа последних записей.  
   Зафиксированы записи об успешной инициализации служб и завершении процессов.  

   ![Просмотр последних строк журнала](Screenshot_15.png){ #fig:015 width=80% }

7. Выполнен фильтр по модулю `sshd.service` для получения сведений о работе SSH-сервера.  
   В журнале отображены записи о запуске службы и активации прослушивания порта 22.  

   ![Просмотр сообщений о работе службы SSHD](Screenshot_16.png){ #fig:016 width=80% }

## Постоянный журнал journald

1. Получены права администратора для внесения изменений в конфигурацию службы журналирования.  

2. Создан каталог `/var/log/journal`, предназначенный для хранения постоянных записей системного журнала.  
   Это позволяет сохранять логи между перезагрузками системы.  

   ![Создание каталога для постоянного хранения журнала](Screenshot_17.png){ #fig:017 width=80% }

3. Установлены необходимые права доступа к каталогу:  
   владельцем назначена группа `systemd-journal`, а права доступа заданы как `2755`.  
   Такая настройка обеспечивает возможность записи службы journald в данный каталог.  

4. Для применения изменений выполнена команда `killall -USR1 systemd-journald`,  
   сигнализирующая службе journald о необходимости перезапуска с учётом новой конфигурации.  

5. После выполнения всех шагов система ведёт **постоянный журнал**,  
   записи которого сохраняются в каталоге `/var/log/journal` и доступны после перезагрузки.  

# Контрольные вопросы

1. Для настройки службы системного журналирования используется файл конфигурации `/etc/rsyslog.conf`.  

2. Сообщения, связанные с аутентификацией пользователей и доступом, сохраняются в файле `/var/log/secure`.  

3. Если не изменять стандартную конфигурацию, ротация файлов журналов выполняется еженедельно.  

4. Для записи всех сообщений с приоритетом `info` в отдельный файл необходимо добавить строку:  
   `*.info /var/log/messages.info`  

5. Для просмотра сообщений журнала в режиме реального времени используется команда `tail -f /var/log/messages`  
   или её системная альтернатива `journalctl -f`.  

6. Чтобы вывести все сообщения, записанные для процесса с PID 1 между 9:00 и 15:00, применяют команду:  
   `journalctl _PID=1 --since "09:00" --until "15:00"`.  

7. Для просмотра всех сообщений journald, зафиксированных после последней перезагрузки системы, используется команда:  
   `journalctl -b`.  

8. Чтобы сделать журнал journald постоянным, необходимо создать каталог `/var/log/journal`,  
   назначить ему владельца `root:systemd-journal`, установить права доступа `chmod 2755`,  
   а затем перезапустить службу journald с помощью команды  
   `killall -USR1 systemd-journald` или перезагрузить систему.  

# Заключение

В ходе лабораторной работы были изучены механизмы системного журналирования в Linux.  
Рассмотрены принципы работы служб `rsyslogd` и `journald`, методы фильтрации и анализа сообщений,  
а также способы настройки постоянного хранения логов.  
Полученные навыки позволяют эффективно контролировать состояние системы и выявлять источники ошибок.  
