---
## Front matter
title: "Отчёт по лабораторной работе №14"
subtitle: "Партиции, файловые системы, монтирование"
author: "Тукаев Тимур"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки создания разделов на диске и файловых систем. Получить навыки монтирования файловых систем.

# Выполнение

## Создание разделов MBR с помощью fdisk

1. После запуска виртуальной машины выполнен просмотр всех доступных дисков командой `fdisk -l`.  
   В списке отображены добавленные устройства `/dev/sdb` и `/dev/sdc`, каждый размером 1.5 GiB.

   ![Просмотр дисков](Screenshot_1.png){ width=80% }

2. Для разметки запущена утилита `fdisk /dev/sdb`.  
   Выведено предупреждение о том, что изменения сохраняются только после выполнения команды записи.  
   Через вызов меню (`m`) отображён перечень доступных команд.

   ![Справка fdisk](Screenshot_2.png){ width=80% }

3. Проверена текущая структура диска (`p`). Так как разметки не было, таблица разделов оказалась пустой.

4. Создан основной раздел.  
   Выполнено добавление нового раздела (`n`), выбран тип `primary`, принят номер по умолчанию.  
   Размер раздела установлен как 300 MiB с параметром `+300M`.  
   Изменения записаны (`w`).

   ![Создание основного раздела](Screenshot_3.png){ width=80% }

5. Выполнена проверка структуры диска командой `fdisk -l /dev/sdb`, где отображён созданный раздел `/dev/sdb1`.  
   В то же время вывод `cat /proc/partitions` показывает данные ядра, в которых новый раздел ещё не отражён.

   ![Проверка разделов](Screenshot_4.png){ width=80% }

   Разница заключается в том, что `fdisk -l` читает таблицу разделов с устройства, а `/proc/partitions` — текущее состояние, известное ядру.

6. Таблица разделов обновлена в ядре с помощью `partprobe /dev/sdb`.

## Создание логических разделов

1. Повторно запущена утилита `fdisk /dev/sdb`.  
   Создан расширенный раздел (`n`, затем `e`), занявший всё оставшееся пространство.

2. После создания расширенного контейнера добавлен логический раздел (`n`).  
   Логическому разделу присвоен номер 5, выбран первый свободный сектор, размер указан как 300 MiB (`+300M`).  
   Изменения сохранены.

   ![Создание расширенного и логического разделов](Screenshot_5.png){ width=80% }

3. После выполнения `partprobe /dev/sdb` и проверки через `cat /proc/partitions` и `fdisk -l` отображаются новые разделы `/dev/sdb4` (extended) и `/dev/sdb5` (logical).

   ![Проверка логических разделов](Screenshot_6.png){ width=80% }

## Создание раздела подкачки

1. Вновь открыт `fdisk /dev/sdb` и создан дополнительный логический раздел (`n`).  
   Размер выбран 300 MiB (`+300M`), раздел получил номер 6.

2. Тип раздела изменён на swap с помощью команды `t`, номер раздела — 6, тип — 82.

3. Изменения записаны (`w`) и таблица обновлена командой `partprobe /dev/sdb`.

   ![Создание swap-раздела](Screenshot_7.png){ width=80% }

4. Выполнена проверка — в списке отображён новый логический раздел `/dev/sdb6` типа Linux swap.

5. Раздел подкачки инициализирован с помощью `mkswap /dev/sdb6` и активирован командой `swapon /dev/sdb6`.

6. Для проверки текущего размера подкачки использована команда `free -m`, в выводе которой отображено новое пространство swap.

   ![Активация swap](Screenshot_8.png){ width=80% }

## Создание разделов GPT с помощью gdisk

1. Выполнен просмотр таблицы разделов на диске `/dev/sdc` с помощью `gdisk -l /dev/sdc`.  
   Поскольку таблица отсутствовала, утилита предложила создать новую GPT.

   ![Просмотр GPT](Screenshot_9.png){ width=80% }

2. Запущена утилита `gdisk /dev/sdc`.  
   Создан новый раздел командой `n`, принят номер по умолчанию, первый сектор оставлен стандартным.  
   Размер раздела установлен как 300 MiB с помощью `+300M`.  
   Тип раздела оставлен 8300 (Linux filesystem).  
   После проверки (`p`) изменения записаны (`w`).

   ![Создание GPT-раздела](Screenshot_10.png){ width=80% }

3. Выполнен просмотр информации о новых разделах с помощью `cat /proc/partitions` и `gdisk -l /dev/sdc`.  
   Раздел `/dev/sdc1` отображается корректно.

   ![Проверка GPT-разметки](Screenshot_11.png){ width=80% }

## Форматирование файловых систем

1. На разделе `/dev/sdb1` создана файловая система XFS командой `mkfs.xfs`.  
   Затем с помощью `xfs_admin -L xfsdisk /dev/sdb1` присвоена метка тома *xfsdisk*.

2. На разделе `/dev/sdb5` создана файловая система EXT4 командой `mkfs.ext4`.  
   Метка `ext4disk` назначена командой `tune2fs -L ext4disk /dev/sdb5`.  
   Далее установлены параметры монтирования по умолчанию `acl,user_xattr`.

   ![Создание XFS и EXT4](Screenshot_12.png){ width=80% }

## Ручное монтирование файловой системы

1. Создана точка монтирования `/mnt/tmp`.

2. Раздел `/dev/sdb5` смонтирован в `/mnt/tmp` и затем отмонтирован.

3. Проверено, что файловая система больше не отображается в выводе `mount`.

## Работа с UUID и настройка /etc/fstab

1. Создана точка монтирования `/mnt/data` для раздела XFS.

2. С помощью `blkid` получены UUID всех блочных устройств.  
   UUID раздела `/dev/sdb1` использован для настройки автоматического монтирования.

   ![UUID устройств](Screenshot_13.png){ width=80% }

3. В файл `/etc/fstab` добавлена строка для автоматического монтирования XFS-раздела:

   ![Редактирование fstab](Screenshot_14.png){ width=80% }

4. Команда `mount -a` выполнена для проверки корректности конфигурации.

5. Проверено, что раздел монтируется в `/mnt/data`, вывод `df -h` это подтверждает.

   ![Проверка монтирования](Screenshot_15.png){ width=80% }
   
## Самостоятельная работа

1. На диске `/dev/sdc` добавлены две GPT-партиции размером по 100 MiB.  
   Первая создана как раздел файловой системы Linux (8300), вторая — как раздел подкачки (8200).  
   Разметка выполнена через `gdisk`, обе партиции записаны на диск.

   ![Создание GPT-разделов](Screenshot_16.png){ width=80% }

2. Раздел `/dev/sdc2` отформатирован в ext4 и ему присвоена метка *ext4disk2*.  
   Затем установлены параметры монтирования по умолчанию `acl,user_xattr`.  
   Раздел `/dev/sdc3` подготовлен как область подкачки с помощью `mkswap`.

   ![Форматирование ext4 и swap](Screenshot_17.png){ width=80% }

3. Для автоматического монтирования настроен файл `/etc/fstab`:  
   — раздел ext4 (`/dev/sdc2`) подключён к `/mnt/data-ext`;  
   — swap-раздел (`/dev/sdc3`) активируется автоматически при загрузке.
   
    ![Редактирование /etc/fstab](Screenshot_18.png){ width=80% }

4. После перезагрузки системы состояние проверено:  
   — точка монтирования `/mnt/data-ext` доступна и содержит файловую систему ext4;  
   — команда `free -m` показывает активное пространство подкачки;  
   — вывод `df -h` подтверждает автоматическое монтирование созданного ext4-раздела.

    ![Проверка разделов](Screenshot_19.png){ width=80% }

Все изменения применены корректно, система работает с новыми GPT-разделами после перезагрузки.

# Контрольные вопросы

1. Для создания разделов с таблицей GUID используется утилита `gdisk`.

2. Для работы с разделами в формате MBR применяется инструмент `fdisk`.

3. Автоматическое монтирование разделов при загрузке выполняется согласно настройкам в файле `/etc/fstab`.

4. Чтобы файловая система не монтировалась автоматически, используют вариант `noauto` в параметрах монтирования.

5. Для форматирования раздела подкачки (тип 82) используется команда `mkswap`.

6. Проверить корректность настроек автоматического монтирования можно командой `mount -a`, которая монтирует все записи из `/etc/fstab` без перезагрузки.

7. Если выполнить `mkfs` без указания файловой системы, будет создана файловая система ext2.

8. Форматирование раздела в EXT4 выполняют командой `mkfs.ext4`.

9. UUID всех устройств можно просмотреть с помощью команды `blkid`.

# Заключение

В ходе лабораторной работы была выполнена разметка дисков с использованием как MBR, так и GPT, что позволило сравнить возможности двух типов таблиц разделов.
Созданы основные, расширенные и логические разделы, подготовлены файловые системы XFS и EXT4, а также выделено и активировано пространство подкачки.
Практическая часть включала ручное и автоматическое монтирование разделов, настройку файла `/etc/fstab` и проверку корректности конфигурации.
Все выполненные действия позволили закрепить навыки работы с блочными устройствами, инструментами разметки и механизмами монтирования в Linux.
