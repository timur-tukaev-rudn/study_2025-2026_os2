---
## Front matter
title: "Отчёт по лабораторной работе №9"
subtitle: "Планировщики событий"
author: "Тукаев Тимур"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков работы с планировщиками событий cron и at.

# Выполнение

## Планирование задач с помощью cron

1. Получены полномочия администратора и проверен статус службы планировщика заданий **crond**.  
   Состояние службы отображается как активное, что подтверждает её корректную работу.

2. Просмотрено содержимое системного файла `/etc/crontab`.  
   В файле указаны переменные окружения, параметры PATH, MAILTO и пример синтаксиса задания.

   ![Просмотр содержимого /etc/crontab](Screenshot_1.png){ #fig:001 width=80% }

3. Проверено текущее расписание для пользователя root.  
   Так как задания ещё не были заданы, список оказался пуст.  
   После этого открыто редактирование crontab и добавлена строка:  

   */1 * * * * logger This message is written from root cron  

   Эта запись означает:  
   - */1 — выполнение каждую минуту,  
   - * * * — каждый час, день, месяц,  
   - команда logger записывает сообщение в системный журнал.  

   ![Редактирование crontab для root](Screenshot_2.png){ #fig:002 width=80% }

4. После сохранения изменений проверено наличие задания в crontab.  
   Далее с помощью команды `grep written /var/log/messages` подтверждено, что сообщения действительно создаются каждую минуту.  

   ![Проверка выполнения cron-заданий и системного журнала](Screenshot_3.png){ #fig:003 width=80% }

5. Изменено расписание задания на:  

   0 */1 * * 1-5 logger This message is written from root cron  

   Это означает:  
   - 0 — выполнение в начале часа,  
   - */1 — каждый час,  
   - 1-5 — с понедельника по пятницу.  

   ![Изменение расписания crontab](Screenshot_4.png){ #fig:004 width=80% }

6. Создан файл сценария `eachhour` в каталоге `/etc/cron.hourly`.  
   Внутри записан скрипт, выполняющий команду logger с добавлением текущей даты:  

   #!/bin/sh  
   logger This message is written at $(date)  

   ![Создание сценария eachhour](Screenshot_5.png){ #fig:005 width=80% }

7. Сценарий сделан исполняемым, после чего в каталоге `/etc/cron.d` создан одноимённый файл с содержимым:  

   11 * * * * root logger This message is written from /etc/cron.d  

   Данная запись означает:  
   - выполнение в 11-й минуте каждого часа,  
   - выполнение от имени root,  
   - запуск команды logger для записи сообщения о запуске из каталога `/etc/cron.d`.  

   ![Создание задания eachhour в /etc/cron.d](Screenshot_6.png){ #fig:006 width=80% }

## Планирование заданий с помощью at

1. Получены полномочия администратора и проверен статус службы **atd**.  
   Служба активна и работает корректно, что позволяет выполнять отложенные задания.  

   ![Проверка статуса службы atd](Screenshot_7.png){ #fig:007 width=80% }

2. Запланировано выполнение команды:  

   at 14:53  
   logger message from at  

   После ввода команды `Ctrl + D` оболочка закрылась, а задание было зарегистрировано для выполнения в заданное время.  

3. Проверено наличие запланированного задания с помощью команды `atq`.  
   В списке отложенных заданий появилось задание с номером 1, предназначенное для выполнения от имени пользователя root.  

4. По завершении выполнения команды проверен системный журнал с помощью:  
   grep 'from at' /var/log/messages  

   В лог-файле появилось сообщение:  
   *message from at*  
   Это подтверждает, что команда была успешно выполнена планировщиком **atd** в указанное время.  

# Контрольные вопросы

1. Чтобы задание выполнялось раз в две недели, используют запись с указанием дня недели через шаг 14.  
   Например:  
   0 0 */14 * * команда  
   Данное выражение означает выполнение команды каждые 14 дней в полночь.

2. Для выполнения задания 1-го и 15-го числа каждого месяца в 2:00 ночи запись будет следующей:  
   0 2 1,15 * * команда  
   Это выражение задаёт выполнение команды в 2 часа утра, первого и пятнадцатого числа каждого месяца.

3. Чтобы задание выполнялось каждые 2 минуты, используется запись:  
   */2 * * * * команда  
   В данном случае */2 в поле минут означает запуск задания каждые две минуты.

4. Для выполнения задания ежегодно 19 сентября запись будет следующей:  
   0 0 19 9 * команда  
   То есть выполнение произойдёт 19 числа 9-го месяца (сентября) в полночь.

5. Чтобы задание выполнялось каждый четверг сентября ежегодно, используют выражение:  
   0 0 * 9 4 команда  
   Здесь 9 — это месяц (сентябрь), а 4 — номер четверга (в cron воскресенье — 0).

6. Чтобы назначить задание cron для пользователя `alice`, используется команда:  
   crontab -u alice -e  
   Например:  
   crontab -u alice -e  
   */5 * * * * logger "Задание выполняется каждые 5 минут от имени alice"

7. Чтобы запретить пользователю `bob` назначать задания через cron, его имя следует добавить в файл `/etc/cron.deny`.  
   Например:  
   echo "bob" >> /etc/cron.deny  
   После этого пользователь `bob` не сможет использовать команду `crontab`.

8. Чтобы задание выполнялось даже при временной недоступности сервера, следует использовать каталог `/etc/cron.daily`, `/etc/cron.weekly` или службу `anacron`.  
   Например, добавив задание в `/etc/cron.daily`, можно гарантировать, что оно выполнится при следующем запуске системы, даже если компьютер был выключен в момент планового запуска.

9. Чтобы узнать, запланированы ли какие-либо задания планировщиком `atd`, используется команда:  
   atq  
   Она выводит список всех отложенных заданий, находящихся в очереди на выполнение.

# Заключение

В ходе выполнения лабораторной работы были изучены принципы планирования заданий с помощью утилит **cron** и **at**.  
Рассмотрены различные способы задания расписания, особенности указания временных интервалов и ограничений для пользователей.  
Получены практические навыки настройки периодических и одноразовых заданий, а также их контроля и диагностики через системные журналы.  
